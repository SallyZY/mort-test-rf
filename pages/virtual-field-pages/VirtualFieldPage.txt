*** Settings ***
Library           Selenium2Library

*** Keywords ***
Select Virtual Field Menu Item
    [Arguments]    ${dataset_index}
    Click Virtual Field Menu Icon    ${dataset_index}
    Click Element    css=body > div:nth-child(6) > div > div > ul > li:nth-child(1)
    Wait Until Element Is Visible    css=div.code-preview    20    找不到虚拟字段对话框

Select Virtul Metric Menu Item
    [Arguments]    ${dataset_index}
    Click Virtual Field Menu Icon    ${dataset_index}
    Click Element    css=body > div:nth-child(6) > div > div > ul > li:nth-child(3)
    Wait Until Element Is Visible    css=div.code-preview    20    找不到虚拟指标对话框

Click Virtual Field Menu Icon
    [Arguments]    ${dataset_index}
    Mouse Over    css=div.MainContent > div > div:nth-child(2) > div.PanelContent > div.dataSetCollection.beautiful-scrollbar > ul:nth-child(${dataset_index}) > div.data-set-item.selected > div
    Sleep    1
    Click Element    css=div.DefaultLayout > div.MainContent > div > div:nth-child(2) > div.PanelContent > div.dataSetCollection.beautiful-scrollbar > ul:nth-child(${dataset_index}) > div.data-set-item.selected > i
    Sleep    1

Select Numeric Type for Virtual Field
    Click Element    css=div.types > div > label:nth-child(1) > span.ant-radio > input

Select Text Type for Virtual Field
    Click Element    css=div.types > div > label:nth-child(2) > span.ant-radio > input

Select Datetime Type for Virtual Field
    Click Element    css=div.types > div > label:nth-child(3) > span.ant-radio > input

Click Create Virtual Field Button
    Click Button    css=div.status-btns > div.btns.clearfix > button

Set Expression for Text Virtual Field
    [Arguments]    ${field_name}    ${vf_function}    ${original_field_type}
    # 选择文本函数
    Select From List By Label    css=div.fields > select:nth-child(5)    ${vf_function}
    # 选择文本字段
    Run Keyword If    "${original_field_type}"=='Text'    Select From List By Label    css=div.fields > select:nth-child(2)    ${field_name}
    ...    ELSE IF    "${original_field_type}"=='Datetime'    Select From List By Label    css=div.fields > select:nth-child(3)    ${field_name}
    # 语法验证
    Click Element    css=div.code-preview > div.code.border-box > a
    Wait Until Element Is Visible    css=div.code-preview > div.preview.border-box.beautiful-scrollbar > table > tbody > tr:nth-child(1)    20    #没有显示预览结果
    Sleep    2

Set Expression for Numeric Virtual Field
    [Arguments]    ${field_name}    ${vf_function}    ${original_field_type}
    # 选择数值函数
    Select From List By Label    css=div.fields > select:nth-child(4)    ${vf_function}
    # 选择数值字段
    Run Keyword If    "${original_field_type}"=='Numeric'    Select From List By Label    css=div.fields > select:nth-child(1)    ${field_name}
    ...    ELSE IF    "${original_field_type}"=='Datetime'    Select From List By Label    css=div.fields > select:nth-child(3)    ${field_name}
    # 语法验证
    Click Element    css=div.code-preview > div.code.border-box > a
    Wait Until Element Is Visible    css=div.code-preview > div.preview.border-box.beautiful-scrollbar > table > tbody > tr:nth-child(1)    20    #没有显示预览结果
    Sleep    2

Input Expression for Virtual Field
    [Arguments]    ${expression}
    #输入表达式
    Input Text    css=div.code-preview > div.code.border-box > textarea    ${expression}
    # 语法验证
    Click Element    css=div.code-preview > div.code.border-box > a
    Wait Until Element Is Visible    css=div.code-preview > div.preview.border-box.beautiful-scrollbar > table > tbody > tr:nth-child(1)    20    #没有显示预览结果
    Sleep    2

Set Name for Virtual Field
    [Arguments]    ${field_name}    ${vf_function}
    Input Text    css=div.name-type > div.name > input[type="text"]    VF_${vf_function}_${field_name}

Input Name for Virtual Field
    [Arguments]    ${vf_name}
    Input Text    css=div.name-type > div.name > input[type="text"]    ${vf_name}
